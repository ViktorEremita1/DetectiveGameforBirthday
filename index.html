<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Детектив Вики: Дело №2024</title>
    <style>
        :root {
            --burgundy: #4b0013;
            --gold: #d4af37;
            --dark: #1a1a1a;
            --light: #f4e7d3;
            /* Размеры увеличены */
            --card-w: 160px; 
            --card-h: 240px;
        }

        body {
            margin: 0; padding: 0;
            background-color: var(--dark);
            color: var(--light);
            font-family: 'Georgia', serif;
            overflow: hidden;
            height: 100vh;
            display: flex; flex-direction: column;
        }

        /* ЭКРАН СТАРТА */
        #start-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, #5a0017 0%, #2c0008 100%);
            z-index: 500; display: flex; flex-direction: column;
            align-items: center; text-align: center;
            padding: 10px 20px; box-sizing: border-box; overflow-y: auto;
        }

        .intro-text {
            width: 95%; max-width: 900px; text-align: left;
            line-height: 1.6; margin: 15px 0; font-size: 1rem;
            color: #fff; background: rgba(0,0,0,0.5);
            padding: 30px; border-radius: 10px; border-left: 5px solid var(--gold);
        }

        .btn-start {
            margin: 20px 0 40px 0; padding: 18px 50px;
            background: var(--gold); color: var(--burgundy);
            font-size: 1.4rem; font-weight: bold; border-radius: 50px;
            text-transform: uppercase; cursor: pointer; border: none;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
        }

        /* ВЕРХНЯЯ ПАНЕЛЬ */
        #status-bar {
            height: 40px; background: var(--gold); color: var(--burgundy);
            display: flex; justify-content: center; align-items: center;
            font-weight: bold; z-index: 10; font-size: 0.9rem; letter-spacing: 2px;
        }

        /* ЗОНА СТОЛА */
        #table-zone {
            flex: 1; padding: 20px; overflow-y: auto;
            background: radial-gradient(circle, #3d000f 0%, #1a1a1a 100%);
            display: flex; flex-wrap: wrap; gap: 15px; justify-content: center;
            align-content: flex-start;
        }

        /* НИЖНЯЯ ИГРОВАЯ ОБЛАСТЬ (Увеличена высота) */
        #game-controls {
            height: 380px; 
            background: #2a000a;
            display: grid;
            grid-template-columns: 140px 1fr 140px;
            align-items: center;
            padding: 0 15px;
            border-top: 3px solid var(--gold);
            gap: 10px;
        }

        /* КОЛОДА И АРХИВ */
        .pile-container {
            display: flex; flex-direction: column; align-items: center; gap: 10px;
            font-size: 0.8rem; color: var(--gold); font-weight: bold;
        }

        /* Стилизация рубашки (теперь через background-image) */
        .card-back {
            width: 90px; height: 135px;
            background-color: var(--burgundy);
            background-size: cover;
            background-position: center;
            border: 2px solid var(--gold);
            border-radius: 6px;
            position: relative;
            box-shadow: 3px 3px 12px rgba(0,0,0,0.6);
        }

        /* Стопка архива */
        #archive-visual { position: relative; width: 90px; height: 135px; margin-top: 5px; }
        .archive-offset-card {
            position: absolute; top: 0; left: 0;
            transition: all 0.3s;
        }

        /* РУКА */
        #hand-zone {
            display: flex; justify-content: center; align-items: center;
            gap: 15px; height: 100%;
        }

        /* КАРТОЧКА (УВЕЛИЧЕНА) */
        .card {
            width: var(--card-w); height: var(--card-h);
            background-color: white; padding: 6px;
            box-sizing: border-box; box-shadow: 0 8px 20px rgba(0,0,0,0.5);
            position: relative; display: flex; flex-direction: column;
            border-radius: 6px; transition: transform 0.2s;
        }

        .card img { width: 100%; height: 160px; object-fit: cover; border-radius: 3px; cursor: zoom-in; }
        
        .card-cost {
            position: absolute; top: -10px; right: -10px;
            background: var(--gold); color: var(--burgundy);
            width: 32px; height: 32px; border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            font-size: 1rem; font-weight: bold; border: 2px solid var(--burgundy);
            z-index: 5;
        }

        .card-actions { margin-top: auto; display: flex; flex-direction: column; gap: 4px; padding-bottom: 2px; }
        
        button {
            font-size: 0.75rem; padding: 8px 0; border: none; border-radius: 4px;
            text-transform: uppercase; cursor: pointer; font-weight: bold;
        }
        .btn-play { background: #27ae60; color: white; }
        .btn-play.disabled { background: #bdc3c7; color: #7f8c8d; cursor: default; }
        .btn-discard { background: #c0392b; color: white; }

        /* Табличные карты (тоже стали чуть больше) */
        .card-table { width: 120px; height: 170px; }
        .card-table img { height: 100%; }

        /* АНИМАЦИОННЫЙ СЛОЙ */
        #anim-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 1000;
        }

        .flying-card {
            position: absolute; width: var(--card-w); height: var(--card-h);
            transition: all 0.6s cubic-bezier(0.25, 0.1, 0.25, 1);
            transform-style: preserve-3d;
        }

        /* ВСПЛЫВАЮЩЕЕ ФОТО */
        #zoom-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 2000;
            justify-content: center; align-items: center;
        }
        #zoom-overlay img { max-width: 95%; max-height: 90%; border: 5px solid white; box-shadow: 0 0 50px var(--gold); }
    </style>
</head>
<body>

<div id="start-screen">
    <h1 style="color: var(--gold); margin-top: 30px; font-size: 2.5rem;">ДЕТЕКТИВ ВИКИ</h1>
    <div class="intro-text">
        На часах 23:50. Пять минут назад Ромарио запер все двери загородного особняка, в котором вы отмечали твой день рождения, и попросил всех собраться в гостиной. Он подошел к тебе, своей жене, и сказал: «Подарок пропал. Я боюсь, что его украли. Никому не могу доверять, даже себе. Боюсь, придется тебе придется прервать праздник и найти его». <br><br>
        В этот день что-то должно пойти не так. Ты знаешь, что каждый из них хранит свои тайны, опасные тайны, но почему хотя бы сегодня все не могло пройти без происшествий. Но они и не догадываются о твоей тайне. Что ж, пусть этот вечер станет днем, когда покров тайны будет сорван с вашей компании, и ты станешь первой.<br><br>
        Все знают, что ты работаешь успешным медиа-аналитиком, но никто и не догадывается, что это лишь прикрытие. На самом деле твой начальник — это государственное управление по безопасности, а ты — агент секретной контрразведки. Пожалуй, ты больше не хочешь, чтобы это было тайной для твоих лучших друзей. Ты рассказываешь об этом. <br><br>
        При этих словах каждый из гостей, и даже твой муж Ромарио, заметно забеспокоились. Что происходит в их головах? Какие секреты там хранятся? И самое главное, кто похитил твой подарок? Сумеешь ли ты найти его? И сколько чужих секретов при этом вскроется?<br><br>
        Прежде чем ты начнешь, помни, что каждая улика имеет свою ценность, но не каждая из них поведет тебя по правильному пути. В процессе расследования ты сможешь убирать карты в архив. В зависимости от того, сколько карт ты убрала в архив, ты сможешь выкладывать все более значимые улики. Ценность каждой улики обозначена в углу под лупой. Чтобы выложить самую ценную улику, тебе нужно убрать в архив 10 улик. Удачи в расследовании!<br><br>
        Ну и поскольку это лишь штука для теста, в архиве уже есть одна карта. На деле это условие будет написано на карте, которая пойдет в архив первой.
    </div>
    <button class="btn-start" onclick="startGame()">Начать расследование</button>
</div>

<div id="status-bar">МАТЕРИАЛЫ ДЕЛА (КЛИКНИ ДЛЯ УВЕЛИЧЕНИЯ)</div>

<div id="table-zone"></div>

<div id="game-controls">
    <div class="pile-container">
        <span id="deck-count">Колода: 45</span>
        <div id="deck-visual" class="card-back"></div>
    </div>

    <div id="hand-zone"></div>

    <div class="pile-container">
        <span id="archive-count">Архив: 1</span>
        <div id="archive-visual"></div>
    </div>
</div>

<div id="anim-layer"></div>

<div id="zoom-overlay" onclick="this.style.display='none'">
    <img id="zoomed-img" src="">
</div>

<script>
    // --- НАСТРОЙКА РУБАШКИ ---
    // Вставь сюда ссылку на изображение своей рубашки
    const cardBackUrl = "https://i.postimg.cc/T33d3Dnf/A4-2.png"; 

    const cardData = [
        { id: 1, cost: 1, img: "https://i.postimg.cc/25hpmRky/A4-5.png" },
        { id: 2, cost: 1, img: "https://i.postimg.cc/vmfRMFYB/A4-6.png" },
        { id: 3, cost: 4, img: "https://i.postimg.cc/BvHWs9Sn/A4-7.png" },
        { id: 4, cost: 2, img: "https://i.postimg.cc/B60rnYbj/A4-11.png" },
        { id: 5, cost: 2, img: "https://i.postimg.cc/Qt32d4Ck/A4-14.png" },
        { id: 6, cost: 3, img: "https://i.postimg.cc/Tw6z3715/A4-12.png" },
        { id: 7, cost: 2, img: "https://i.postimg.cc/sX4tQYG6/A4-18.png" },
        { id: 8, cost: 2, img: "https://i.postimg.cc/rmNv01ty/A4-24.png" },
        { id: 9, cost: 3, img: "https://i.postimg.cc/BvHWs9Sn/A4-7.png" },
        { id: 10, cost: 1, img: "https://i.postimg.cc/XNxRngbJ/A4-49.png" },
        { id: 11, cost: 2, img: "https://i.postimg.cc/KjcCn1nk/A4-33.png" },
        { id: 12, cost: 3, img: "https://i.postimg.cc/C1sWBGfY/A4-23.png" },
        { id: 13, cost: 5, img: "https://i.postimg.cc/Kz268qjD/A4-13.png" },
        { id: 14, cost: 6, img: "https://i.postimg.cc/C1g3xP5c/A4-16.png" },
        { id: 15, cost: 1, img: "https://i.postimg.cc/RhC2cWcK/A4-34.png" },
        { id: 16, cost: 4, img: "https://i.postimg.cc/LXpc8C5T/A4-15.png" },
        { id: 17, cost: 6, img: "https://i.postimg.cc/fyW1xVxW/A4-28.png" },
        { id: 18, cost: 7, img: "https://i.postimg.cc/TwJZLV5c/A4-17.png" },
        { id: 19, cost: 3, img: "https://i.postimg.cc/D0fRqSqk/A4-25.png" },
        { id: 20, cost: 5, img: "https://i.postimg.cc/8ckxh7hG/A4-26.png" },
        { id: 21, cost: 7, img: "https://i.postimg.cc/pTJghfnR/A4-22.png" },
        { id: 22, cost: 8, img: "https://i.postimg.cc/J07Sbsb3/A4-35.png" },
        { id: 23, cost: 3, img: "https://i.postimg.cc/XY0fD7Kz/A4-51.png" },
        { id: 24, cost: 4, img: "https://i.postimg.cc/fLf6tcSF/A4-19.png" },
        { id: 25, cost: 4, img: "https://i.postimg.cc/3RFP4X0c/A4-20.png" },
        { id: 26, cost: 5, img: "https://i.postimg.cc/fyW1xVxw/A4-27.png" },
        { id: 27, cost: 8, img: "https://i.postimg.cc/RhPyGvR8/A4-46.png" },
        { id: 28, cost: 4, img: "https://i.postimg.cc/QNS2jq3d/A4-48.png" },
        { id: 29, cost: 5, img: "https://i.postimg.cc/8cy9wTHj/A4-38.png" },
        { id: 30, cost: 4, img: "https://i.postimg.cc/sxfbpMpX/A4-31.png" },
        { id: 31, cost: 9, img: "https://i.postimg.cc/d3WpnJBN/A4-44.png" },
        { id: 32, cost: 10, img: "https://i.postimg.cc/nrVNvXv4/A4-37.png" },
        { id: 33, cost: 5, img: "https://i.postimg.cc/ZRx1B8yk/A4-21.png" },
        { id: 34, cost: 6, img: "https://i.postimg.cc/44wDX1gt/A4-52.png" },
        { id: 35, cost: 7, img: "https://i.postimg.cc/Vvs2jJjL/A4-29.png" },
        { id: 36, cost: 9, img: "https://i.postimg.cc/v8XJGvsm/A4-50.png" },
        { id: 37, cost: 10, img: "https://i.postimg.cc/x8shg9RM/A4-39.png" },
        { id: 38, cost: 6, img: "https://i.postimg.cc/pr04kPZq/A4-43.png" },
        { id: 39, cost: 7, img: "https://i.postimg.cc/vT8CW4Wm/A4-30.png" },
        { id: 40, cost: 8, img: "https://i.postimg.cc/PJ69Kd4F/A4-45.png" },
        { id: 41, cost: 10, img: "https://i.postimg.cc/3r9s3ZT3/A4-47.png" },
        { id: 42, cost: 8, img: "https://i.postimg.cc/Znf2jJcP/A4-40.png" },
        { id: 43, cost: 9, img: "https://i.postimg.cc/7hBdXqVN/A4-41.png" },
        { id: 44, cost: 10, img: "https://i.postimg.cc/BbhkNJgN/A4-42.png" },
        { id: 45, cost: 7, img: "https://i.postimg.cc/gc4CGKW3/A4-53.png" }
    ];

    let deck = [...cardData].reverse();
    let hand = [];
    let table = [];
    let archiveCount = 1;
    let isBusy = false;

    // Установка рубашки
    document.querySelectorAll('.card-back').forEach(el => {
        el.style.backgroundImage = `url(${cardBackUrl})`;
    });

    function startGame() {
        document.getElementById('start-screen').style.display = 'none';
        initialDraw();
    }

    async function initialDraw() {
        for(let i=0; i<3; i++) {
            await drawCardAnim();
        }
        render();
    }

    function createFlyingCard(startRect, isBack = true) {
        const fly = document.createElement('div');
        fly.className = 'flying-card ' + (isBack ? 'card-back' : 'card');
        if(isBack) fly.style.backgroundImage = `url(${cardBackUrl})`;
        fly.style.left = startRect.left + 'px';
        fly.style.top = startRect.top + 'px';
        document.getElementById('anim-layer').appendChild(fly);
        return fly;
    }

    async function drawCardAnim() {
        if (deck.length === 0 || hand.length >= 3) return;
        isBusy = true;
        const card = deck.pop();
        
        const startEl = document.getElementById('deck-visual');
        const fly = createFlyingCard(startEl.getBoundingClientRect(), true);
        
        render();
        await new Promise(r => setTimeout(r, 50));
        
        fly.style.left = '50%';
        fly.style.top = (window.innerHeight - 300) + 'px';
        fly.style.transform = 'translateX(-50%) rotateY(180deg)';

        await new Promise(r => setTimeout(r, 600));
        hand.push(card);
        fly.remove();
        isBusy = false;
        render();
    }

    async function playCard(idx) {
        if (isBusy) return;
        const card = hand[idx];
        if (archiveCount < card.cost) {
            alert("Мало опыта в архиве!");
            return;
        }

        isBusy = true;
        const cardEls = document.querySelectorAll('#hand-zone .card');
        const startRect = cardEls[idx].getBoundingClientRect();
        
        const fly = createFlyingCard(startRect, false);
        fly.innerHTML = cardEls[idx].innerHTML;
        fly.style.background = "white";
        
        hand.splice(idx, 1);
        render();

        fly.style.top = '100px';
        fly.style.left = '50%';
        fly.style.transform = 'translateX(-50%) scale(0.6)';
        fly.style.opacity = '0';

        await new Promise(r => setTimeout(r, 600));
        table.push(card);
        fly.remove();
        
        await drawCardAnim();
        isBusy = false;
        render();
    }

    async function discardToArchive(idx) {
        if (isBusy) return;
        isBusy = true;
        
        const cardEls = document.querySelectorAll('#hand-zone .card');
        const startRect = cardEls[idx].getBoundingClientRect();
        const targetRect = document.getElementById('archive-visual').getBoundingClientRect();
        
        const fly = createFlyingCard(startRect, false);
        fly.innerHTML = cardEls[idx].innerHTML;
        fly.style.background = "white";

        hand.splice(idx, 1);
        render();

        await new Promise(r => setTimeout(r, 50));
        fly.style.left = targetRect.left + 'px';
        fly.style.top = targetRect.top + 'px';
        fly.style.transform = 'rotateY(180deg) scale(0.5)';

        await new Promise(r => setTimeout(r, 600));
        archiveCount++;
        fly.remove();
        
        await drawCardAnim();
        isBusy = false;
        render();
    }

    function render() {
        const handZone = document.getElementById('hand-zone');
        handZone.innerHTML = '';
        hand.forEach((card, i) => {
            const cardEl = document.createElement('div');
            cardEl.className = 'card';
            cardEl.innerHTML = `
                <div class="card-cost">${card.cost}</div>
                <img src="${card.img}" onclick="zoom('${card.img}')">
                <div class="card-actions">
                    <button class="btn-play ${archiveCount >= card.cost ? '' : 'disabled'}" onclick="playCard(${i})">На стол</button>
                    <button class="btn-discard" onclick="discardToArchive(${i})">В архив</button>
                </div>
            `;
            handZone.appendChild(cardEl);
        });

        const tableZone = document.getElementById('table-zone');
        tableZone.innerHTML = '';
        table.forEach(card => {
            const cardEl = document.createElement('div');
            cardEl.className = 'card card-table';
            cardEl.innerHTML = `<img src="${card.img}" onclick="zoom('${card.img}')">`;
            tableZone.appendChild(cardEl);
        });

        document.getElementById('deck-count').innerText = `Колода: ${deck.length}`;
        document.getElementById('archive-count').innerText = `Архив: ${archiveCount}`;

        const archVis = document.getElementById('archive-visual');
        archVis.innerHTML = '';
        const displayLimit = Math.min(archiveCount, 8); 
        for(let i=0; i < displayLimit; i++) {
            const back = document.createElement('div');
            back.className = 'card-back archive-offset-card';
            back.style.backgroundImage = `url(${cardBackUrl})`;
            back.style.left = (i * 2) + 'px';
            back.style.top = -(i * 2) + 'px';
            back.style.width = '90px';
            back.style.height = '135px';
            archVis.appendChild(back);
        }

        if (hand.length === 0 && deck.length === 0) {
            showFinalButton();
        }
    }

    function zoom(src) {
        document.getElementById('zoomed-img').src = src;
        document.getElementById('zoom-overlay').style.display = 'flex';
    }

    function showFinalButton() {
        const hz = document.getElementById('hand-zone');
        hz.innerHTML = `<div style="text-align:center">
            <p style="font-size:1rem; color: var(--gold); font-weight:bold;">РАССЛЕДОВАНИЕ ЗАВЕРШЕНО <br><br>
            Все важные улики перед тобой. Ты можешь еще раз изучить их. Когда будешь готова подвести итоги своего расследования, свяжись со своим коллегой из секретной службы контрразведки Анной Тень.</p>
            <a href="https://t.me/AnnaShadowBot" class="btn-start" style="padding:15px 30px; text-decoration:none; display:inline-block">Связаться с Анной Тень</a>
        </div>`;
    }
</script>
</body>
</html>